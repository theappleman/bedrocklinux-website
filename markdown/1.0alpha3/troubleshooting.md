Title: Bedrock Linux 1.0alpha3 Bosco Tips, Tricks and Troubleshooting
Nav: bosco.nav

Bedrock Linux 1.0alpha3 Bosco Tips, Tricks and Troubleshooting
==============================================================

This page contains tips, tricks and troubleshooting advice for various software
and clients for Bedrock Linux 1.0alpha3 Bosco.

- [General issues](#general)
	- [Sudo PATH](#sudo-path)
	- [Proprietary Nvidia Drivers](#proprietary-nvidia-drivers)
	- [DNS from the core does not work](#dns)
	- [/dev/fd errors](#dev-fd-errors)
- [Client specific issues](#client-specific)
	- [Debian-based Linux distributions](#debian-based)
		- [Ubuntu/Upstart fix](#upstart-fix)
		- [Locale packages](#upstart-fix)
		- [Statoverride](#statoverride)
		- [Ubuntu resolv.conf](#ubuntu-resolvconf)
	- [Arch Linux](#arch)
		- [Pacman Filesystem Errors](#pacman-filesystem-errors)
	- [Fedora](#fedora)
		- [Problems with using yum.](#yum-problems)



## {id="general"} General issues

### {id="sudo-path"} Sudo PATH

It may be advisable to look at the `PATH` generated by `/etc/profile` for root
and set it as `/etc/sudoer`'s `secure_path` in `/etc/sudoers`

### {id="proprietary-nvidia-drivers"} Proprietary Nvidia Drivers

The official Nvidia proprietary drivers works well in Bedrock Linux, given a
few requirements.  For the proprietary Nvidia driver to work, you should ensure
the directory containing the kernel modules (historically `/lib/modules`,
although there is a push to move it to `/usr/lib/modules`) is either shared or
copied into at least the client(s) which run X11/xinit/startx. Moreover, you
should ensure nouveau is not enabled. Bedrock currently does not have any
system in place to manage kernel module loading. If you compiled your kernel
with nouveau, you can simple (re)move the module. To find it, run

	{class="cmd"} find /lib/modules -name nouveau

and move or delete the file (as root).

The proprietary Nvidia driver should be compiled using the same version of the
same compiler used to compile the kernel. If you compiled the kernel yourself
in the installer host, you can make a Bedrock Linux client from the installer
host and use that to compile the nvidia driver. Otherwise, you can recompile
the Linux kernel using a client (and install it and reboot) and then use that
client again to compile the nvidia driver.  If you received the kernel from a
client, it may be wise to use that same client to compile X11.

In addition to creating a kernel module, the proprietary Nvidia driver may
alter X11 files.  To ensure it works properly, it should be installed in the
same client which will provide X11.

### {id="dns"} DNS from the core does not work

It seems that even if `ldd` reports busybox was statically compiled, when
compiled against glibc, the DNS libraries do not seem to be pulled it and
functionality such as `ping` or `wget` do not seem to work.  This is considered
a minor issue as a client should be able to provide this functionality such
that the core Bedrock Linux does not need it.  If you insist on remedying it,
you have two choices:

- you can statically compile busybox against a library such as uclibc or musl,
  but be warned [some consider this difficult](knownissues.html#static)

- you can compare the strace output of a "static" busybox in a client where it
works the strace output of it in the core to see what libraries it is using and
copy them into the core.

TODO: do the above and provide the libraries in the instructions here

#### {id="dev-fd-errors"} /dev/fd errors

If you receive errors along these lines:

	/dev/fd/~(N~): No such file or directory

where ~(N~) is a number, this is most likely due to the fact that the device
manager you are using is not setting up `/dev/fd` as some programs expect.
This can be solved (for the current session) by running:

- {class="rcmd"}
- rm -r /dev/fd
- ln -s /proc/self/fd /dev

To solve this permanently, one could simply add those two lines to
`/etc/rc.local` in the core Bedrock such that it is run every time Bedrock Linux
is booted.

## {id="client-specific"} Client specific issues

### {id="debian-based"} Debian-based Linux distributions

#### {id="upstart-fix"} Ubuntu/Upstart fix

Ubuntu uses Upstart for its init system. Many services in Ubuntu have been
modified to depend on `init` to be specific to Upstart and refuse to operate
otherwise. This means they do not work in chroots out of the box. See the
[here](https://bugs.launchpad.net/ubuntu/+source/upstart/+bug/430224)
for more information. One way to alleviate this is to run the following two
commands as root (within the Ubuntu client, via using `brc` for each command or
`brc` to open a shell in the client and run it from the shell):

- {class="rcmd"}
- dpkg-divert --local --rename --add /sbin/initctl
- ln -s /bin/true /sbin/initctl

#### {id="upstart-fix"} Locale packages

In Debian, if you get errors about locale, try installing the `locales-all`
package.

In Ubuntu, if you get errors about locale, try installing the appropriate
`language-pack-~(LANGUAGE~)` (such as `language-pack-en`) package.

#### {id="statoverride"} Statoverride

If you get an error about statoverride when using apt/dpkg, it can most likely
be resolved by deleting the contents of `/var/lib/dpkg/statoverride` (from
within the client - ie, `~(/var/chroot/client~)/var/lib/dpkg/statoverride` from
outside). Leave an empty file there. This seems to occur due to the fact an
expected daemon is not running.

#### {id="ubuntu-resolvconf"} Ubuntu resolv.conf

If you have difficulty sharing `/etc/resolv.conf` in Ubuntu, note that it creates
a symlink for that file directing elsewhere. It should be safe to remove the
symlink and just create an empty file in its place

### {id="arch"} Arch Linux

#### {id="pacman-filesystem-errors"} Pacman Filesystem Errors

If you get errors about `could not get filesystem information for ~(PATH~)`
when using `pacman`, this is normal and mostly harmless so long as you have
sufficient free disk space for the operation you are attempting. This seems to
be caused by `pacman` assuming that the mount points it sees are the same as the
ones init sees (which would be a fair assumption in almost every case except
Bedrock Linux). You can configure `pacman` to not check for free disk space by
commenting out `CheckSpace` from `~(/var/chroot/arch~)/etc/pacman.conf`

### {id="fedora"} Fedora

#### {id="yum-problems"} Problems with using yum.

Febootstrap does not seem to always include the `fedora-release` package. This is
troublesome, as the package is utilized to access the Fedora repositories. If you
find difficulties using `yum`, you might be able to respolve this by downloading
the `fedora-release` package for the given release (e.g.:
`fedora-release-17.noarch.rpm`), and install it thusly (from within the Fedora
client, via `brc`):

	{class="rcmd"} rpm -i fedora-~(VERSION~).noarch.rpm

You should then be able to use `yum` to access Fedora's repositories as one
normally would.
